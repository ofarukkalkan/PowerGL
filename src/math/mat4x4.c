#include "mat4x4.h"
#include <stdio.h>
void powergl_print4x4(float m[4][4]){
  unsigned i,j;
  printf("\n");
  for(i=0;i<4;++i){
    printf("[ ");
    for(j=0;j<4;j++){
      printf("%f ",m[i][j]);
    }
    printf(" ]\n");
  }
}
void powergl_zero4x4(GLfloat m[4][4]){
  m[0][0]=0.0f;
  m[0][1]=0.0f;
  m[0][2]=0.0f;
  m[0][3]=0.0f;
  m[1][0]=0.0f;
  m[1][1]=0.0f;
  m[1][2]=0.0f;
  m[1][3]=0.0f;
  m[2][0]=0.0f;
  m[2][1]=0.0f;
  m[2][2]=0.0f;
  m[2][3]=0.0f;
  m[3][0]=0.0f;
  m[3][1]=0.0f;
  m[3][2]=0.0f;
  m[3][3]=0.0f;
}
void powergl_ident4x4(GLfloat m[4][4]){
  m[0][0]=1.0f;
  m[0][1]=0.0f;
  m[0][2]=0.0f;
  m[0][3]=0.0f;
  m[1][0]=0.0f;
  m[1][1]=1.0f;
  m[1][2]=0.0f;
  m[1][3]=0.0f;
  m[2][0]=0.0f;
  m[2][1]=0.0f;
  m[2][2]=1.0f;
  m[2][3]=0.0f;
  m[3][0]=0.0f;
  m[3][1]=0.0f;
  m[3][2]=0.0f;
  m[3][3]=1.0f;
}
void powergl_mult4x4(GLfloat m[4][4],GLfloat n[4][4],GLfloat r[4][4]){
  r[0][0]=m[0][0]*n[0][0] +m[0][1]*n[1][0] + m[0][2]*n[2][0] + m[0][3]*n[3][0];
  r[0][1]=m[0][0]*n[0][1] +m[0][1]*n[1][1] + m[0][2]*n[2][1] + m[0][3]*n[3][1];
  r[0][2]=m[0][0]*n[0][2] +m[0][1]*n[1][2] + m[0][2]*n[2][2] + m[0][3]*n[3][2];
  r[0][3]=m[0][0]*n[0][3] +m[0][1]*n[1][3] + m[0][2]*n[2][3] + m[0][3]*n[3][3];

  r[1][0]=m[1][0]*n[0][0] +m[1][1]*n[1][0] + m[1][2]*n[2][0] + m[1][3]*n[3][0];
  r[1][1]=m[1][0]*n[0][1] +m[1][1]*n[1][1] + m[1][2]*n[2][1] + m[1][3]*n[3][1];
  r[1][2]=m[1][0]*n[0][2] +m[1][1]*n[1][2] + m[1][2]*n[2][2] + m[1][3]*n[3][2];
  r[1][3]=m[1][0]*n[0][3] +m[1][1]*n[1][3] + m[1][2]*n[2][3] + m[1][3]*n[3][3];

  r[2][0]=m[2][0]*n[0][0] +m[2][1]*n[1][0] + m[2][2]*n[2][0] + m[2][3]*n[3][0];
  r[2][1]=m[2][0]*n[0][1] +m[2][1]*n[1][1] + m[2][2]*n[2][1] + m[2][3]*n[3][1];
  r[2][2]=m[2][0]*n[0][2] +m[2][1]*n[1][2] + m[2][2]*n[2][2] + m[2][3]*n[3][2];
  r[2][3]=m[2][0]*n[0][3] +m[2][1]*n[1][3] + m[2][2]*n[2][3] + m[2][3]*n[3][3];

  r[3][0]=m[3][0]*n[0][0] +m[3][1]*n[1][0] + m[3][2]*n[2][0] + m[3][3]*n[3][0];
  r[3][1]=m[3][0]*n[0][1] +m[3][1]*n[1][1] + m[3][2]*n[2][1] + m[3][3]*n[3][1];
  r[3][2]=m[3][0]*n[0][2] +m[3][1]*n[1][2] + m[3][2]*n[2][2] + m[3][3]*n[3][2];
  r[3][3]=m[3][0]*n[0][3] +m[3][1]*n[1][3] + m[3][2]*n[2][3] + m[3][3]*n[3][3];

  m[0][0]=r[0][0];
  m[0][1]=r[0][1];
  m[0][2]=r[0][2];
  m[0][3]=r[0][3];
  
  m[1][0]=r[1][0];
  m[1][1]=r[1][1];
  m[1][2]=r[1][2];
  m[1][3]=r[1][3];
  
  m[2][0]=r[2][0];
  m[2][1]=r[2][1];
  m[2][2]=r[2][2];
  m[2][3]=r[2][3];
  
  m[3][0]=r[3][0];
  m[3][1]=r[3][1];
  m[3][2]=r[3][2];
  m[3][3]=r[3][3];
  
}
void powergl_trans4x4(GLfloat m[4][4]){
  m[0][0] = m[0][0];
  m[0][1] = m[1][0];
  m[0][2] = m[2][0];
  m[0][3] = m[3][0];
  m[1][0] = m[0][1];
  m[1][1] = m[1][1];
  m[1][2] = m[2][1];
  m[1][3] = m[3][1];
}
void powergl_rot4x4(GLfloat m[4][4],GLfloat n[4][4],float angle,powergl_vec3* axis){
  float a,c,s,tmp,rot[9];
  powergl_vec3 temp;
  
  a = angle;
  c = cosf(a);
  s = sinf(a);

  powergl_normvec3(axis,axis);
  tmp=1.0f-c;
  temp.x= axis->x*tmp;
  temp.y= axis->y*tmp;
  temp.z= axis->z*tmp;

  rot[0]=(c + temp.x * axis->x);
  rot[1]=(temp.x * axis->y + s * axis->z);
  rot[2]=(temp.x * axis->z - s * axis->y);
  rot[3]=(temp.y * axis->x - s * axis->z);
  rot[4]=(c + temp.y * axis->y);
  rot[5]=(temp.y * axis->z + s * axis->x);
  rot[6]=(temp.z * axis->x + s * axis->y);
  rot[7]=(temp.z * axis->y - s * axis->x);
  rot[8]=(c + temp.z * axis->z);
  
  n[0][0] = m[0][0] * rot[0] + m[1][0] * rot[1] + m[2][0] * rot[2];
  n[0][1] = m[0][1] * rot[0] + m[1][1] * rot[1] + m[2][1] * rot[2];
  n[0][2] = m[0][2] * rot[0] + m[1][2] * rot[1] + m[2][2] * rot[2];
  
  n[1][0] = m[0][0] * rot[3] + m[1][0] * rot[4] + m[2][0] * rot[5];
  n[1][1] = m[0][1] * rot[3] + m[1][1] * rot[4] + m[2][1] * rot[5];
  n[1][2] = m[0][2] * rot[3] + m[1][2] * rot[4] + m[2][2] * rot[5];
 
  n[2][0] = m[0][0] * rot[6] + m[1][0] * rot[7] + m[2][0] * rot[8];
  n[2][1] = m[0][1] * rot[6] + m[1][1] * rot[7] + m[2][1] * rot[8];
  n[2][2] = m[0][2] * rot[6] + m[1][2] * rot[7] + m[2][2] * rot[8];
 
  m[0][0]=n[0][0];
  m[0][1]=n[0][1];
  m[0][2]=n[0][2];
 
  m[1][0]=n[1][0];
  m[1][1]=n[1][1];
  m[1][2]=n[1][2];
 
  m[2][0]=n[2][0];
  m[2][1]=n[2][1];
  m[2][2]=n[2][2];
 }
